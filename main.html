<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GAMEND - Premium Hub</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --accent: #00f2ff;
            --bg: #05050a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
        }

        /* 7 Premium Themes preserved */
        body.light-theme { --bg: #f0f2f5; --card-bg: rgba(0,0,0,0.05); --text: #1a1a2e; --border: rgba(0,0,0,0.1); --accent: #0072ff; }
        body.neon-blue { --bg: #000b1a; --accent: #00f2ff; }
        body.emerald { --bg: #020d04; --accent: #00ff88; }
        body.crimson { --bg: #0d0202; --accent: #ff0044; }
        body.gold { --bg: #0d0a02; --accent: #ffcc00; }
        body.purple { --bg: #0a020d; --accent: #bf00ff; }

        body {
            background: var(--bg); color: var(--text); margin: 0; font-family: 'Inter', sans-serif;
            overflow-x: hidden; min-height: 100vh; transition: 0.4s;
        }

        #bg-canvas { position: fixed; inset: 0; z-index: -1; }

        /* Splash Screen */
        #splash-screen {
            position: fixed; inset: 0; z-index: 10000; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-logo { width: 100px; height: 100px; border-radius: 25px; box-shadow: 0 0 25px var(--accent); }
        .progress-bar { width: 60%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 20px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--accent); transition: width 4s linear; }

        /* Navigation Tabs */
        .nav-tabs {
            position: sticky; top: 0; background: var(--bg); backdrop-filter: blur(20px); z-index: 1000;
            display: flex; overflow-x: auto; padding: 15px 10px; gap: 10px; border-bottom: 1px solid var(--border);
        }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .tab {
            padding: 8px 18px; border-radius: 50px; background: var(--card-bg); border: 1px solid var(--border);
            font-size: 11px; font-weight: 800; white-space: nowrap; transition: 0.3s; color: var(--text);
        }
        .tab.active { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }

        /* Game Sections */
        .game-section { display: none; padding: 20px; animation: fadeIn 0.5s ease; }
        .game-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 500px; margin: 0 auto; }
        .card {
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px;
            padding: 15px; text-align: center; transition: 0.2s; cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .card:active { transform: scale(0.95); border-color: var(--accent); }
        .icon-img { width: 100%; aspect-ratio: 1; border-radius: 20px; margin-bottom: 10px; object-fit: cover; }
        .card p { margin: 5px 0 0; font-weight: 700; font-size: 14px; }
        .tag { font-size: 10px; color: var(--accent); text-transform: uppercase; font-weight: bold; }

        /* Menu */
        .menu-btn { position: fixed; right: 20px; top: 15px; z-index: 5001; color: var(--accent); font-size: 30px; cursor: pointer; }
        .menu-dropdown {
            position: fixed; right: 20px; top: 65px; background: var(--bg); border: 1px solid var(--border);
            border-radius: 20px; width: 180px; display: none; flex-direction: column; z-index: 5000; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .menu-item { padding: 15px 20px; font-size: 14px; border-bottom: 1px solid var(--border); color: var(--text); cursor: pointer; }
        .menu-item:last-child { border-bottom: none; }

        /* Global UI elements */
        .share-btn {
            background: var(--accent); color: #000; padding: 16px 40px; border-radius: 100px;
            font-weight: 900; border: none; margin: 30px auto; display: block; cursor: pointer;
            box-shadow: 0 0 20px var(--accent); font-size: 14px;
        }

        #game-view { display: none; position: fixed; inset: 0; z-index: 9999; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body onclick="closeMenu()">

    <canvas id="bg-canvas"></canvas>

    <div id="splash-screen">
        <img src="https://mozhihub.github.io/Mad-drive/img/drivemad.png" class="loader-logo">
        <h2 style="letter-spacing: 4px; color: #fff;">GAMEND</h2>
        <div class="progress-bar"><div class="progress-fill" id="fill"></div></div>
    </div>

    <div class="menu-btn" onclick="toggleMenu(event)">‚ãÆ</div>
    <div class="menu-dropdown" id="dropdown">
        <div class="menu-item" onclick="logicReport(event)">Report</div>
        <div class="menu-item" onclick="logicSettings(event)">Settings</div>
        <div class="menu-item" onclick="logicAbout(event)">About</div>
        <div class="menu-item" onclick="logicContact(event)">Contact</div>     
    </div>

    <div id="hub-content" style="display:none;">
        <div style="padding: 50px 25px 10px; text-align: center;">
            <div style="font-size: 32px; font-weight: 900; color: var(--accent);">GAMEND HUB</div>
            <div style="color: #00ff88; font-size: 12px; margin-top: 5px;">‚óè <span id="online-val">...</span> PLAYERS ONLINE</div>
        </div>

        <div class="nav-tabs">
            <div class="tab active" onclick="switchTab(0, 'racing')">üèéÔ∏è RACING</div>
            <div class="tab" onclick="switchTab(1, 'arcade')">üïπÔ∏è ARCADE</div>
            <div class="tab" onclick="switchTab(2, 'puzzle')">üß© PUZZLE</div>
            <div class="tab" onclick="switchTab(3, 'creative')">üé® CREATIVE</div>
            <div class="tab" onclick="switchTab(4, 'social')">‚ù§Ô∏è SOCIAL</div>
        </div>

        <div id="racing" class="game-section active">
            <div class="grid">
                <div class="card" onclick="openGame('https://mozhihub.github.io/Mad-drive/')">
                    <img src="etc/drive.jpg" class="icon-img"><p>Mad Drive</p><span class="tag">Racing</span>
                </div>
            </div>
        </div>

        <div id="arcade" class="game-section">
            <div class="grid">
                <div class="card" onclick="openGame('https://mozhihub.github.io/Knife/')">
                    <img src="etc/knife.jpg" class="icon-img"><p>Knife Hit</p><span class="tag">Arcade</span>
                </div>
            </div>
        </div>

        <div id="puzzle" class="game-section">
            <div class="grid">
                <div class="card" onclick="openGame('https://mozhihub.github.io/Hexa/')">
                    <img src="etc/hexa.jpg" class="icon-img"><p>Hexa Master</p><span class="tag">Puzzle</span>
                </div>
            </div>
        </div>

        <div id="creative" class="game-section">
            <div class="grid">
                <div class="card" onclick="openGame('https://mozhihub.github.io/Paint/')">
                    <img src="etc/paint.jpg" class="icon-img"><p>Paint</p><span class="tag">Creative</span>
                </div>
                <div class="card" onclick="openGame('https://mozhihub.github.io/Earth-/')">
                    <img src="etc/earth.jpg" class="icon-img"><p>Earth</p><span class="tag">Creative</span>
                </div>
            </div>
        </div>

        <div id="social" class="game-section">
            <div class="grid">
                <div class="card" onclick="openGame('https://mozhihub.github.io/insto/')">
                    <img src="etc/insto.jpg" class="icon-img"><p>Insto</p><span class="tag">Social</span>
                </div>
                <div class="card" onclick="openGame('https://mozhihub.github.io/Love-Calculator/')">
                    <img src="etc/love.jpg" class="icon-img"><p>Love Calc</p><span class="tag">Fun</span>
                </div>
            </div>
        </div>

        <button class="share-btn" onclick="shareBot()">INVITE FRIENDS</button>
    </div>

    <div id="game-view"><iframe id="game-iframe"></iframe></div>

    <script>
        const tg = window.Telegram.WebApp;
        const hub = document.getElementById('hub-content');
        const gameView = document.getElementById('game-view');
        const gameIframe = document.getElementById('game-iframe');

        tg.expand();
        tg.enableClosingConfirmation();

        // --- BACK BUTTON LOGIC (Strict Original Logic) ---
        tg.onEvent('backButtonClicked', () => {
            if (gameView.style.display === 'block') {
                tg.showConfirm("Exit game and return to Hub?", (ok) => {
                    if (ok) closeGame();
                });
            } else {
                tg.showConfirm("Do you want to exit GAMEND?", (ok) => {
                    if (ok) tg.close();
                });
            }
        });

        // --- CORE GAME FUNCTIONS ---
        function openGame(url) {
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            gameIframe.src = url;
            gameView.style.display = 'block';
            hub.style.display = 'none';
        }

        function closeGame() {
            gameView.style.display = 'none';
            gameIframe.src = "";
            hub.style.display = 'block';
        }

        // --- MENU & POPUP LOGIC (Strict Original Requirements) ---
        function toggleMenu(e) { e.stopPropagation(); const dd = document.getElementById('dropdown'); dd.style.display = (dd.style.display === 'flex') ? 'none' : 'flex'; }
        function closeMenu() { document.getElementById('dropdown').style.display = 'none'; }

        function logicSettings(e) {
            e.stopPropagation(); closeMenu();
            tg.showPopup({
                title: 'Settings',
                message: 'Select Theme:',
                buttons: [
                    {id:'dark', text:'Dark Mode'}, {id:'light', text:'Light Mode'}, 
                    {id:'blue', text:'Neon Blue'}, {id:'green', text:'Emerald'},
                    {id:'red', text:'Crimson'}, {id:'gold', text:'Gold'}, 
                    {id:'purp', text:'Purple'}, {type:'cancel'}
                ]
            }, (id) => {
                document.body.className = '';
                if(id === 'light') document.body.classList.add('light-theme');
                else if(id !== 'cancel' && id !== 'dark') document.body.classList.add(id === 'blue' ? 'neon-blue' : id === 'green' ? 'emerald' : id === 'red' ? 'crimson' : id === 'gold' ? 'gold' : 'purple');
            });
        }

        function logicAbout(e) {
            e.stopPropagation(); closeMenu();
            tg.showPopup({
                title: 'About GAMEND',
                message: 'Premium arcade games for Telegram.\n\nProvided by: mozhihub.com',
                buttons: [{type:'close'}]
            });
        }

        function logicContact(e) {
            e.stopPropagation(); closeMenu();
            tg.showPopup({
                title: 'Contact Us',
                message: 'Website: mozhihub.com\nEmail: info@mozhihub.com',
                buttons: [{id:'visit', text:'Visit Web'}, {type:'close'}]
            }, (id) => { if(id === 'visit') tg.openLink('https://mozhihub.com'); });
        }

        function logicReport(e) {
            e.stopPropagation(); closeMenu();
            tg.showConfirm("Send report to kaviyarasan@mozhihub.com?", (ok) => {
                if(ok) tg.openLink("mailto:kaviyarasan@mozhihub.com?subject=GamendBot Report");
            });
        }

        // --- TAB NAVIGATION ---
        function switchTab(index, id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.game-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.getElementById(id).classList.add('active');
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        // --- BACKGROUND PARTICLES ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let dots = [];
        function initCanvas() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            dots = [];
            for(let i=0; i<25; i++) dots.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: Math.random()-0.5, vy: Math.random()-0.5});
        }
        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "rgba(0, 242, 255, 0.3)";
            dots.forEach(d => {
                d.x += d.vx; d.y += d.vy;
                if(d.x<0 || d.x>canvas.width) d.vx*=-1;
                if(d.y<0 || d.y>canvas.height) d.vy*=-1;
                ctx.beginPath(); ctx.arc(d.x, d.y, 1.5, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(draw);
        }
        initCanvas(); draw();
        window.onresize = initCanvas;

        // --- INITIALIZATION ---
        window.onload = () => {
            document.getElementById('fill').style.width = '100%';
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                hub.style.display = 'block';
                tg.BackButton.show();
            }, 4000);
        };

        function shareBot() { tg.openTelegramLink("https://t.me/share/url?url=https://t.me/gamendbot&text=Play Games!"); }
        
        // --- FIREBASE SYNC (Strict Original Config) ---
        const firebaseConfig = { apiKey: "AIzaSyBb0upYoLF4_isVBfJUAMOEflMCgl5_5aE", databaseURL: "https://game-3a2e9-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "game-3a2e9" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        firebase.database().ref('global_players').on('value', snap => { 
            document.getElementById('online-val').innerText = snap.val() || 1; 
        });
    </script>
</body>
</html>
                          
